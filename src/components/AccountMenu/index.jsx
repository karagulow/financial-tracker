import { useDispatch } from 'react-redux';
import { useEffect, useRef } from 'react';

import styles from './AccountMenu.module.scss';
import { logout } from '../../redux/slices/authSlice';

export const AccountMenu = ({ setAccMenuOpen, accMenuOpen, username }) => {
	const dispatch = useDispatch();

	const handleClickLogout = () => {
		dispatch(logout());
	};

	const menuRef = useRef(null);

	const toggleMenu = () => {
		setAccMenuOpen(!accMenuOpen);
	};

	const closeMenu = () => {
		setAccMenuOpen(false);
	};

	useEffect(() => {
		const handleClickOutside = event => {
			if (menuRef.current && !menuRef.current.contains(event.target)) {
				closeMenu();
			}
		};

		document.addEventListener('mousedown', handleClickOutside);
		return () => {
			document.removeEventListener('mousedown', handleClickOutside);
		};
	}, []);

	return (
		<div className={styles.account_menu} ref={menuRef}>
			<p className={styles.account_menuUsername}>{username}</p>
			<hr className={styles.account_menuLine} />
			<div className={styles.account_menuItem} onClick={toggleMenu}>
				<div className={styles.account_menuItem__icon}>
					<svg
						width='30'
						height='30'
						viewBox='0 0 30 30'
						fill='none'
						xmlns='http://www.w3.org/2000/svg'
					>
						<path
							fill-rule='evenodd'
							clip-rule='evenodd'
							d='M16.8726 4.6596C16.4832 4.5 15.9885 4.5 15.0001 4.5C14.0117 4.5 13.518 4.5 13.1275 4.6596C12.609 4.87192 12.1963 5.28095 11.9801 5.79675C11.8812 6.0309 11.8433 6.30495 11.8275 6.7029C11.8205 6.99123 11.7399 7.27302 11.5933 7.52161C11.4466 7.77019 11.2389 7.97737 10.9896 8.12355C10.7357 8.26436 10.4502 8.33895 10.1597 8.34042C9.86915 8.34189 9.58295 8.27018 9.32758 8.13195C8.9718 7.94505 8.71391 7.84215 8.45918 7.80855C7.90189 7.73556 7.33824 7.88499 6.89081 8.22435C6.55608 8.47845 6.30872 8.90265 5.81505 9.75C5.32032 10.5973 5.07401 11.0205 5.01823 11.4352C4.94454 11.9875 5.09612 12.5461 5.43927 12.9882C5.59505 13.1898 5.81505 13.3588 6.15504 13.5709C6.65713 13.8828 6.97923 14.4141 6.97923 15C6.97923 15.5859 6.65713 16.1172 6.15609 16.428C5.81505 16.6411 5.59505 16.8102 5.43821 17.0118C5.26883 17.2301 5.14451 17.4798 5.07242 17.7463C5.00033 18.0129 4.98191 18.2911 5.01823 18.5647C5.07401 18.9784 5.32032 19.4026 5.81505 20.25C6.30977 21.0973 6.55608 21.5205 6.89081 21.7756C7.33711 22.1148 7.90131 22.2639 8.45918 22.1915C8.71391 22.1579 8.9718 22.0549 9.32758 21.868C9.58308 21.7296 9.86948 21.6578 10.1602 21.6593C10.451 21.6608 10.7366 21.7355 10.9907 21.8764C11.5023 22.1704 11.8054 22.7112 11.8275 23.2971C11.8433 23.6961 11.8812 23.9691 11.9801 24.2032C12.1949 24.7177 12.6075 25.1272 13.1275 25.3404C13.5169 25.5 14.0117 25.5 15.0001 25.5C15.9885 25.5 16.4832 25.5 16.8726 25.3404C17.3911 25.1281 17.8038 24.719 18.02 24.2032C18.1189 23.9691 18.1568 23.6961 18.1726 23.2971C18.1937 22.7112 18.4979 22.1694 19.0105 21.8764C19.2644 21.7356 19.5499 21.661 19.8404 21.6596C20.131 21.6581 20.4172 21.7298 20.6725 21.868C21.0283 22.0549 21.2862 22.1579 21.5409 22.1915C22.0988 22.265 22.663 22.1148 23.1093 21.7756C23.444 21.5215 23.6914 21.0973 24.1851 20.25C24.6798 19.4026 24.9261 18.9795 24.9819 18.5647C25.0181 18.291 24.9995 18.0128 24.9272 17.7462C24.8549 17.4797 24.7304 17.2301 24.5608 17.0118C24.4051 16.8102 24.1851 16.6411 23.8451 16.429C23.343 16.1172 23.0209 15.5859 23.0209 15C23.0209 14.4141 23.343 13.8828 23.844 13.572C24.1851 13.3588 24.4051 13.1898 24.5619 12.9882C24.7313 12.7699 24.8556 12.5202 24.9277 12.2537C24.9998 11.9871 25.0182 11.7089 24.9819 11.4352C24.9261 11.0215 24.6798 10.5973 24.1851 9.75C23.6903 8.90265 23.444 8.4795 23.1093 8.22435C22.6619 7.88499 22.0982 7.73556 21.5409 7.80855C21.2862 7.84215 21.0283 7.94505 20.6725 8.13195C20.417 8.27037 20.1306 8.34218 19.8399 8.34071C19.5492 8.33924 19.2635 8.26454 19.0094 8.12355C18.7604 7.97724 18.5528 7.77001 18.4064 7.52143C18.26 7.27285 18.1795 6.99113 18.1726 6.7029C18.1568 6.3039 18.1189 6.0309 18.02 5.79675C17.913 5.54132 17.7566 5.30943 17.5597 5.11431C17.3629 4.91919 17.1294 4.76468 16.8726 4.6596ZM15.0001 18.15C16.7579 18.15 18.1821 16.7398 18.1821 15C18.1821 13.2601 16.7569 11.85 15.0001 11.85C13.2422 11.85 11.818 13.2601 11.818 15C11.818 16.7398 13.2433 18.15 15.0001 18.15Z'
							fill='#333333'
						/>
					</svg>
				</div>
				<p className={styles.account_menuItem__text}>Настройки</p>
			</div>
			<div className={styles.account_menuItem}>
				<div className={styles.account_menuItem__icon}>
					<svg
						width='30'
						height='30'
						viewBox='0 0 30 30'
						fill='none'
						xmlns='http://www.w3.org/2000/svg'
					>
						<g clip-path='url(#clip0_224_296)'>
							<path
								d='M16.8605 6.38947C18.6344 6.38947 19.8949 6.39133 20.8512 6.51916C21.786 6.64421 22.3256 6.87949 22.7191 7.27133C23.1126 7.66316 23.3488 8.20042 23.4744 9.13229C23.6028 10.0845 23.6047 11.3388 23.6047 13.1053C23.6047 13.2895 23.6782 13.4662 23.809 13.5965C23.9398 13.7268 24.1173 13.8 24.3023 13.8C24.4874 13.8 24.6648 13.7268 24.7957 13.5965C24.9265 13.4662 25 13.2895 25 13.1053V13.0534C25 11.3508 25 10.0021 24.8577 8.94703C24.7107 7.86139 24.4019 6.98232 23.706 6.28851C23.0093 5.59562 22.1265 5.28808 21.0363 5.14173C19.9758 5 18.6223 5 16.9126 5H16.8605C16.6754 5 16.498 5.0732 16.3671 5.20348C16.2363 5.33377 16.1628 5.51048 16.1628 5.69474C16.1628 5.87899 16.2363 6.0557 16.3671 6.18599C16.498 6.31628 16.6754 6.38947 16.8605 6.38947ZM13.0874 5H13.1395C13.3246 5 13.502 5.0732 13.6329 5.20348C13.7637 5.33377 13.8372 5.51048 13.8372 5.69474C13.8372 5.87899 13.7637 6.0557 13.6329 6.18599C13.502 6.31628 13.3246 6.38947 13.1395 6.38947C11.3656 6.38947 10.106 6.39133 9.14884 6.51916C8.21395 6.64421 7.67442 6.87949 7.28093 7.27133C6.88744 7.66316 6.65116 8.20042 6.52558 9.13229C6.39721 10.0845 6.39535 11.3388 6.39535 13.1053C6.39535 13.2895 6.32184 13.4662 6.191 13.5965C6.06017 13.7268 5.88271 13.8 5.69767 13.8C5.51264 13.8 5.33518 13.7268 5.20434 13.5965C5.0735 13.4662 5 13.2895 5 13.1053V13.0534C5 11.3508 5 10.0021 5.14233 8.94703C5.2893 7.86139 5.59814 6.98232 6.29395 6.28851C6.9907 5.59562 7.87349 5.28808 8.96372 5.14173C10.0242 5 11.3777 5 13.0874 5Z'
								fill='#333333'
							/>
							<path
								d='M8.89679 8.89679C8.3999 9.39367 8.3999 10.1942 8.3999 11.7942C8.3999 12.8606 8.3999 13.3942 8.73085 13.7261C9.06273 14.057 9.59733 14.057 10.6628 14.057H11.7942C12.8606 14.057 13.3942 14.057 13.7261 13.7261C14.057 13.3942 14.057 12.8596 14.057 11.7942V10.6628C14.057 9.59639 14.057 9.06273 13.7261 8.73085C13.3942 8.3999 12.8596 8.3999 11.7942 8.3999C10.1942 8.3999 9.39367 8.3999 8.89679 8.89679ZM8.89679 21.103C8.3999 20.6061 8.3999 19.8056 8.3999 18.2056C8.3999 17.1392 8.3999 16.6056 8.73085 16.2737C9.06273 15.9428 9.59733 15.9428 10.6628 15.9428H11.7942C12.8606 15.9428 13.3942 15.9428 13.7261 16.2737C14.057 16.6056 14.057 17.1392 14.057 18.2056V19.337C14.057 20.4034 14.057 20.9371 13.7261 21.268C13.3942 21.5999 12.8596 21.5999 11.7942 21.5999C10.1942 21.5999 9.39367 21.5999 8.89679 21.103ZM15.9428 10.6628C15.9428 9.59639 15.9428 9.06273 16.2737 8.73085C16.6065 8.3999 17.1402 8.3999 18.2056 8.3999C19.8056 8.3999 20.6061 8.3999 21.103 8.89679C21.5999 9.39367 21.5999 10.1942 21.5999 11.7942C21.5999 12.8606 21.5999 13.3942 21.268 13.7261C20.938 14.057 20.4034 14.057 19.337 14.057H18.2056C17.1392 14.057 16.6056 14.057 16.2737 13.7261C15.9428 13.3942 15.9428 12.8596 15.9428 11.7942V10.6628ZM16.2746 21.269C15.9428 20.9371 15.9428 20.4025 15.9428 19.337V18.2056C15.9428 17.1392 15.9428 16.6056 16.2737 16.2737C16.6065 15.9428 17.1402 15.9428 18.2056 15.9428H19.337C20.4034 15.9428 20.9371 15.9428 21.268 16.2737C21.5999 16.6056 21.5999 17.1392 21.5999 18.2056C21.5999 19.8056 21.5999 20.6061 21.103 21.103C20.6061 21.5999 19.8056 21.5999 18.2056 21.5999C17.1392 21.5999 16.6056 21.5999 16.2737 21.268'
								fill='#333333'
							/>
							<path
								d='M24.3023 16.2C24.4874 16.2 24.6648 16.2731 24.7957 16.4034C24.9265 16.5337 25 16.7104 25 16.8947V16.9466C25 18.6491 25 19.9978 24.8577 21.0529C24.7107 22.1386 24.4019 23.0176 23.706 23.7114C23.0093 24.4043 22.1265 24.7119 21.0363 24.8582C19.9758 25 18.6223 25 16.9126 25H16.8605C16.6754 25 16.498 24.9268 16.3671 24.7965C16.2363 24.6662 16.1628 24.4895 16.1628 24.3052C16.1628 24.121 16.2363 23.9442 16.3671 23.814C16.498 23.6837 16.6754 23.6105 16.8605 23.6105C18.6344 23.6105 19.8949 23.6086 20.8512 23.4808C21.786 23.3557 22.3256 23.1205 22.7191 22.7286C23.1126 22.3368 23.3488 21.7995 23.4744 20.8677C23.6028 19.9163 23.6047 18.6612 23.6047 16.8947C23.6047 16.7104 23.6782 16.5337 23.809 16.4034C23.9398 16.2731 24.1173 16.2 24.3023 16.2ZM6.39535 16.8947C6.39535 16.7104 6.32184 16.5337 6.191 16.4034C6.06017 16.2731 5.88271 16.2 5.69767 16.2C5.51264 16.2 5.33518 16.2731 5.20434 16.4034C5.0735 16.5337 5 16.7104 5 16.8947V16.9466C5 18.6491 5 19.9978 5.14233 21.0529C5.2893 22.1386 5.59814 23.0176 6.29395 23.7114C6.9907 24.4043 7.87349 24.7119 8.96372 24.8582C10.0242 25 11.3777 25 13.0874 25H13.1395C13.3246 25 13.502 24.9268 13.6329 24.7965C13.7637 24.6662 13.8372 24.4895 13.8372 24.3052C13.8372 24.121 13.7637 23.9442 13.6329 23.814C13.502 23.6837 13.3246 23.6105 13.1395 23.6105C11.3656 23.6105 10.106 23.6086 9.14884 23.4808C8.21395 23.3557 7.67442 23.1205 7.28093 22.7286C6.88744 22.3368 6.65116 21.7995 6.52558 20.8677C6.39721 19.9163 6.39535 18.6612 6.39535 16.8947Z'
								fill='#333333'
							/>
						</g>
						<defs>
							<clipPath id='clip0_224_296'>
								<rect
									width='20'
									height='20'
									fill='white'
									transform='translate(5 5)'
								/>
							</clipPath>
						</defs>
					</svg>
				</div>
				<p className={styles.account_menuItem__text}>Категории</p>
			</div>
			<div className={styles.account_menuItem}>
				<div className={styles.account_menuItem__icon}>
					<svg
						width='30'
						height='30'
						viewBox='0 0 30 30'
						fill='none'
						xmlns='http://www.w3.org/2000/svg'
					>
						<path
							d='M13.1633 22.225C13.1633 22.2604 13.1675 22.349 13.176 22.4906C13.1845 22.6323 13.1866 22.7496 13.1824 22.8426C13.1781 22.9355 13.1654 23.0396 13.1441 23.1547C13.1229 23.2698 13.0804 23.3561 13.0166 23.4137C12.9528 23.4712 12.8656 23.5 12.7551 23.5H8.67347C7.66156 23.5 6.79634 23.1259 6.07781 22.3777C5.35927 21.6296 5 20.7286 5 19.675V10.325C5 9.27135 5.35927 8.37044 6.07781 7.62227C6.79634 6.87409 7.66156 6.5 8.67347 6.5H12.7551C12.8656 6.5 12.9613 6.54206 13.0421 6.62617C13.1229 6.71029 13.1633 6.8099 13.1633 6.925C13.1633 6.96042 13.1675 7.04896 13.176 7.19063C13.1845 7.33229 13.1866 7.44961 13.1824 7.54258C13.1781 7.63555 13.1654 7.73958 13.1441 7.85469C13.1229 7.96979 13.0804 8.05612 13.0166 8.11367C12.9528 8.17122 12.8656 8.2 12.7551 8.2H8.67347C8.11224 8.2 7.6318 8.40807 7.23214 8.82422C6.83248 9.24036 6.63265 9.74063 6.63265 10.325V19.675C6.63265 20.2594 6.83248 20.7596 7.23214 21.1758C7.6318 21.5919 8.11224 21.8 8.67347 21.8H12.6531L12.7997 21.8133L12.9464 21.8531L13.0485 21.9262L13.1378 22.0457L13.1633 22.225ZM25 15C25 15.2302 24.9192 15.4294 24.7577 15.5977L17.8189 22.8227C17.6573 22.9909 17.466 23.075 17.2449 23.075C17.0238 23.075 16.8325 22.9909 16.6709 22.8227C16.5094 22.6544 16.4286 22.4552 16.4286 22.225V18.4H10.7143C10.4932 18.4 10.3019 18.3159 10.1403 18.1477C9.97874 17.9794 9.89796 17.7802 9.89796 17.55V12.45C9.89796 12.2198 9.97874 12.0206 10.1403 11.8523C10.3019 11.6841 10.4932 11.6 10.7143 11.6H16.4286V7.775C16.4286 7.54479 16.5094 7.34557 16.6709 7.17734C16.8325 7.00911 17.0238 6.925 17.2449 6.925C17.466 6.925 17.6573 7.00911 17.8189 7.17734L24.7577 14.4023C24.9192 14.5706 25 14.7698 25 15Z'
							fill='#333333'
						/>
					</svg>
				</div>
				<p
					className={styles.account_menuItem__text}
					onClick={handleClickLogout}
				>
					Выйти
				</p>
			</div>
		</div>
	);
};
